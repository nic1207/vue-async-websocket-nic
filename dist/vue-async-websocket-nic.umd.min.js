(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue-async-websocket-nic"]=t():e["vue-async-websocket-nic"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="e2c3")}({"5e2d":function(e,t,n){var o,r,c;(function(n,s){r=[],o=s,c="function"===typeof o?o.apply(t,r):o,void 0===c||(e.exports=c)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(p){var n,o,r,c=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,s=/@([^@]*):(\d+):(\d+)\s*$/gi,i=c.exec(p.stack)||s.exec(p.stack),l=i&&i[1]||!1,u=i&&i[2]||!1,a=document.location.href.replace(document.location.hash,""),d=document.getElementsByTagName("script");l===a&&(n=document.documentElement.outerHTML,o=new RegExp("(?:[^\\n]+?\\n){0,"+(u-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=n.replace(o,"$1").trim());for(var f=0;f<d.length;f++){if("interactive"===d[f].readyState)return d[f];if(d[f].src===l)return d[f];if(l===a&&d[f].innerHTML&&d[f].innerHTML.trim()===r)return d[f]}return null}}return e}))},e2c3:function(e,t,n){"use strict";if(n.r(t),"undefined"!==typeof window){var o=window.document.currentScript,r=n("5e2d");o=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var c=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);c&&(n.p=c[1])}const s=function(e){let t="";do{t=Math.random().toString(36).substring(2,7)}while(""==t||-1!=e.indexOf(t));return t};let i=0;const l=function(e){return i++,i};var u=()=>{const e={},t=(t,n)=>{Object.keys(e).forEach(o=>{const r=e[o];"any"!==r.type.toLowerCase()&&r.type!==t||r.callback(n)})},n=(t,n)=>{const o=s(Object.keys(e));return e[o]={type:""===t?"any":t,callback:n},o},o=t=>t in e&&(delete e[t],!0);return{fireListeners:t,addEventListener:n,removeEventListener:o}};const a={"parse-json":!0,timeout:!0,"max-timeout":-1,hooks:{"bad-websocket":null,"timed-out":null},callback:{"send-data-only":!0}};var d=e=>{const t={},n=e=>{console.log("fireCallback(",e,")"),console.log("callbacks=",t),e in t?(t[e]["callback"](!0===t[e]["options"]["send-data-only"]?JSON.parse(event.data):event),"timeout"in t[e]&&clearTimeout(t[e]["timeout"]),delete t[e]):(console.log("id=",e),console.error("ID(data._id) is passed by message, but not found in callbacks!"))},o=(e,t,n={})=>new Promise((o,c)=>{r(e,t,e=>{o(e)},{...n,hooks:{"bad-websocket":()=>{c("Cannot send, as webSocket is null or not connected!")},"timed-out":e=>{c(`No answer after ${e}ms!`)}}})}),r=(n,o,r=null,c={})=>{if(c={...a,...c},null===n||1!=n.readyState){if(null===c["hooks"]["bad-websocket"])throw"Cannot send, as webSocket is null or not connected!";return void c["hooks"]["bad-websocket"]()}let i=o;if(null!==r){const n=i[e["create-id"]]=!0===e["create-autoid-func"]?l(Object.keys(t)):s(Object.keys(t));if(t[n]={},t[n]["options"]=c["callback"],t[n]["callback"]=r,!0===c["timeout"]){const o=c["max-timeout"]>0?c["max-timeout"]:e["max-timeout"];t[n]["timeout"]=setTimeout(()=>{if(clearTimeout(t[n]["timeout"]),delete t[n],null===c["hooks"]["timed-out"])throw`No answer after ${o}ms!`;c["hooks"]["timed-out"](o)},o)}}!0===c["parse-json"]&&(i=JSON.stringify(i)),!0===e["debug"]&&console.log("[debug] Send json: ",i),n.send(i)};return{send:r,sendAsync:o,fireCallback:n}};const f={debug:!0,protocols:"","load-on-start":!1,"max-timeout":5e3,reconnect:!0,"max-reconnect-count":4,"reconnect-delay":2e3,"create-autoid-func":null,"response-id":"-","response-type":"_type"},p={install:function(e,t,n={}){if(console.log("webSocketPlugin.install(url=",t,"options=",n,")"),"undefined"===typeof t||null===t)throw"URL is not set";let o=null;n={...f,...n};const r=d(n),c=u();let s=0,i=null;const l=()=>{if(console.log("open()"),null!==o)return!1;!0===n["debug"]&&console.log("[debug] Starting WebSocket on url: "+t),o=new WebSocket(t),m()},a=()=>{if(console.log("open()"),null===o)return!1;!0===n["debug"]&&console.log("[debug] Close connection"),o.close()},p=()=>{console.log("reconnect()"),s<n["max-reconnect-count"]?i=setTimeout(()=>{++s,o=null,l()},n["reconnect-delay"]):console.error(`Couldn't reconnect after ${s} times.`)},m=()=>{console.log("registerEvents()"),o.onopen=e=>{!0===n["debug"]&&console.log("[debug] Websocket Connection opened!"),s=0,clearTimeout(i),c.fireListeners("onopen",e)},o.onclose=e=>{!0===n["reconnect"]&&p(),c.fireListeners("onclose",e)},o.onerror=e=>{c.fireListeners("onerror",e)},o.onmessage=e=>{console.log("onmessage()"),!0===n["debug"]&&console.log("[debug] Message: ",e);const t=JSON.parse(e.data);if(n["response-id"]in t)return void r.fireCallback(t[n["response-id"]]);const o=t[n["response-type"]]||"any";c.fireListeners(o,t)}};"object"===typeof t?(o=t,t=o.url,m()):null===o&&!0===n["load-on-start"]&&l(),e.prototype.$websocket={getReadyState:()=>o.readyState,sendAsync:(e,t={})=>r.sendAsync(o,e,t),send:(e,t=null,n={})=>r.send(o,e,t,n),open:l,close:a,addEventListener:c.addEventListener,removeEventListener:c.removeEventListener}}};var m=p;t["default"]=m}})}));
//# sourceMappingURL=vue-async-websocket-nic.umd.min.js.map